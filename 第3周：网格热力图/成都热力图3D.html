<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>热力图3D</title>
    <style>
        html,
        body,
        #map {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }
        
        .demo-title {
          position: absolute;
          top: 25px;
          left: 25px;
          z-index: 1;
        }

        h1 {
          font-size: 18px;
          margin: 0;
          color: rgb(180, 180, 190);
        }

        h3 {
          font-size: 12px;
          font-weight: normal;
          margin-top: 5px;
          color: rgb(150,150,150);
        }
    </style>
</head>

<body>
    <div id="map"></div>
    <script src="https://webapi.amap.com/maps?v=2.0&key=90c5facfe648930b2202208e739619dc"></script>
    <script src="https://webapi.amap.com/loca?v=2.0.0&key=90c5facfe648930b2202208e739619dc"></script>
    <script src="data/cd_bus_o_heat.js"></script>
    <script>
      	var map = new AMap.Map('map', {
            zoom: 11.7,
            center: [104.065767,30.65744],
            pitch: 45,
            showLabel: false,
            viewMode: '3D',
            mapStyle: 'amap://styles/white',
        });

        var loca = new Loca.Container({
            map,
        });

        // 数据转换过程
        let originData = heat.data;
        let geoData = {"type": "FeatureCollection",features:[]}
        originData.forEach(element=>{
            geoData.features.push({
                "type": "Feature",
                "properties": {
                    "count": element.count
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [
                        element.lng,
                        element.lat
                    ]
                }
            })
        })
        var geo = new Loca.GeoJSONSource({
            data: geoData,
        });

        var heatmap = new Loca.HeatMapLayer({
            // loca,
            zIndex: 10,
            opacity: 1,
            visible: true,
            zooms: [2, 22],
        });

        heatmap.setSource(geo, {
            radius: 20,
            unit: 'px',
            height: 90,
            // radius: 10,
            // unit: 'px',
            // height: 10,
            gradient: {
                0.1: 'rgba(50,48,118,1)',
                0.2: 'rgba(127,60,255,1)',
                0.4: 'rgba(166,53,219,1)',
                0.6: 'rgba(254,64,95,1)',
                0.8: 'rgba(255,98,4,1)',
                1: 'rgba(236,220,79,1)',
            },
            value: function (index, feature) {
                return feature.properties.count;
            },
            min: 0,
            max: 1000,  //4.6
            heightBezier: [0, .53, .37, .98],
        });
        loca.add(heatmap);
      
      
    </script>
</body>

</html>